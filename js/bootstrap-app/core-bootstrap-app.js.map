{"version":3,"sources":["webpack:///webpack/bootstrap a5fb3dc7a4a103eacaf6","webpack:///external \"lib_core_app\"","webpack:///delegated ./src/scripts/application.ts from dll-reference lib_core_app","webpack:///delegated ./src/scripts/utility.ts from dll-reference lib_core_app","webpack:///delegated ./node_modules/react/index.js from dll-reference lib_core_app","webpack:///./src/scripts/bootstrap/bootstrap.js","webpack:///./src/scripts/internal.tsx","webpack:///./src/scripts/Main/App.jsx","webpack:///delegated ./node_modules/react-router-dom/es/index.js from dll-reference lib_core_app","webpack:///delegated ./src/scripts/Main/NotFoundPage.jsx from dll-reference lib_core_app","webpack:///delegated ./node_modules/react-dom/index.js from dll-reference lib_core_app","webpack:///delegated ./src/scripts/gdn.ts from dll-reference lib_core_app","webpack:///delegated ./src/scripts/apiv2.ts from dll-reference lib_core_app","webpack:///./src/scripts/legacy/index.ts","webpack:///./src/scripts/legacy/atwho.ts"],"names":["__webpack_require__","moduleId","installedModules","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","lib_core_app","_application","_utility","_internal","debug","getMeta","_gdn2","default","apiv2","_apiv2","onContent","e","_mountComponents","target","log","_executeReady","then","contentEvent","CustomEvent","bubbles","cancelable","document","dispatchEvent","catch","error","logError","parent","componentExists","addComponent","_App2","nodes","querySelectorAll","Array","forEach","node","getAttribute","Component","getComponent","_reactDom2","render","_react2","createElement","_reactRouterDom","App","PureComponent","routes","getRoutes","map","route","type","_extends","key","props","path","exact","push","Route","component","_NotFoundPage2","BrowserRouter","basename","Switch","_atwho","$","fn","atwho","onReady","initializeAtComplete","window","gdn","atCompleteInit","flag","subtext","shouldStartWithSpace","nonExcludedCharacters","excludeWhiteSpace","excluded","lines","split","lastLine","length","regexStr","match","RegExp","exec","rawMatch","replace","editorElement","iframe","iframeAtWhoRepositionHandler","event","offset","context","suggestionElement","view","$el","$inputor","lineHeight","parseInt","css","iframeOffset","leftCoordinate","left","topCoordinate","top","selectHeight","at","text","query","fontMirror","font","fontWidth","width","each","index","element","outerHeight","height","windowHeight","scrollPosition","scrollTop","newOffset","iframeWindow","contentWindow","tpl","limit","maxSuggestions","callbacks","remote_filter","callback","minCharacters","filterSuccessHandler","data","isArray","result","_typeof","atCache","atEmpty","shouldContinueFiltering","filterString","slice","serverLimit","isQueryEmpty","getJSON","formatUrl","q","before_insert","value","$li","username","requiresQuotation","test","hasQuotation","insert","this","highlighter","li","regexp","str","$1","$2","$3","$4","matcher","matchAtMention","cWindow","emojiTemplate","insert_tpl","matchFakeEmoji","tplEval","emojiList","on","emojiData","emojis","emoji","emojiFormat","format","emojiAssetPath","assetPath","entries","_ref","_ref2","emojiImageUrl","parts","filename","ext"],"mappings":"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","file":"bootstrap-app/core-bootstrap-app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/js/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap a5fb3dc7a4a103eacaf6","module.exports = lib_core_app;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lib_core_app\"\n// module id = 0\n// module chunks = 0","module.exports = (__webpack_require__(0))(8);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./src/scripts/application.ts from dll-reference lib_core_app\n// module id = 1\n// module chunks = 0","module.exports = (__webpack_require__(0))(166);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./src/scripts/utility.ts from dll-reference lib_core_app\n// module id = 2\n// module chunks = 0","module.exports = (__webpack_require__(0))(1);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./node_modules/react/index.js from dll-reference lib_core_app\n// module id = 3\n// module chunks = 0","/**\n * @author Adam Charron <adam.c@vanillaforums.com>\n * @copyright 2009-2018 Vanilla Forums Inc.\n * @license GPLv2\n */\n\nimport { onContent, getMeta, _executeReady } from \"@core/application\";\nimport { log, logError, debug } from \"@core/utility\";\nimport { _mountComponents } from \"@core/internal\";\nimport gdn from \"@core/gdn\";\nimport apiv2 from \"@core/apiv2\";\n\n// Right now this is imported here instead of being its own bundle.\n// Once we have some part of vanilla that can function without the legacy js,\n// this should be pulled out into its own javascript bundle.\nimport \"@core/legacy\";\n\n// Inject the debug flag into the utility.\ndebug(getMeta('debug', false));\n\n// Export the API to the global object.\ngdn.apiv2 = apiv2;\n\n// Mount all data-react components.\nonContent((e) => {\n    _mountComponents(e.target);\n});\n\nlog(\"Bootstrapping\");\n_executeReady().then(() => {\n    log(\"Bootstrapping complete.\");\n\n    const contentEvent = new CustomEvent('X-DOMContentReady', { bubbles: true, cancelable: false });\n    document.dispatchEvent(contentEvent);\n}).catch(error => {\n    logError(error);\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/bootstrap/bootstrap.js","/**\n * Internal functions that should not be used outside of core.\n *\n * @module internal\n */\n\nimport { addComponent, componentExists, getComponent } from \"@core/application\";\nimport App from \"@core/Main/App\";\nimport { logError } from \"@core/utility\";\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\n/**\n * Mount all declared components on the dom.\n *\n * The page signifies that an element contains a component with the `data-react=\"<Component>\"` attribute.\n *\n * @param parent - The parent element to search. This element is not included in the search.\n */\nexport function _mountComponents(parent: Element) {\n    if (!componentExists('App')) {\n        addComponent('App', App);\n    }\n\n    const nodes = parent.querySelectorAll('[data-react]');\n\n    Array.prototype.forEach.call(nodes, (node) => {\n        const name = node.getAttribute('data-react');\n        const Component = getComponent(name);\n\n        if (Component) {\n            ReactDOM.render(<Component />, node);\n        } else {\n            logError(\"Could not find component %s.\", name);\n        }\n    });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/internal.tsx","import React from 'react';\nimport { getRoutes, getMeta } from \"@core/application\";\nimport { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\nimport NotFoundPage from \"@core/Main/NotFoundPage\";\n\n/**\n * The root application component.\n *\n * This component renders the top-level pages that have been registered with {@link module:application.addRoutes}.\n */\nexport default class App extends React.PureComponent {\n    render() {\n        const routes = getRoutes().map((route) => {\n            return <route.type key={route.key || route.props.path + (route.props.exact ? '!' : '')} {...route.props} />;\n        });\n\n        routes.push(<Route key=\"@not-found\" component={NotFoundPage} />);\n\n        return <Router basename={getMeta('context.basePath', '')}>\n            <Switch>{routes}</Switch>\n        </Router>;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/Main/App.jsx","module.exports = (__webpack_require__(0))(229);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./node_modules/react-router-dom/es/index.js from dll-reference lib_core_app\n// module id = 7\n// module chunks = 0","module.exports = (__webpack_require__(0))(257);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./src/scripts/Main/NotFoundPage.jsx from dll-reference lib_core_app\n// module id = 8\n// module chunks = 0","module.exports = (__webpack_require__(0))(192);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./node_modules/react-dom/index.js from dll-reference lib_core_app\n// module id = 9\n// module chunks = 0","module.exports = (__webpack_require__(0))(11);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./src/scripts/gdn.ts from dll-reference lib_core_app\n// module id = 10\n// module chunks = 0","module.exports = (__webpack_require__(0))(169);\n\n\n//////////////////\n// WEBPACK FOOTER\n// delegated ./src/scripts/apiv2.ts from dll-reference lib_core_app\n// module id = 11\n// module chunks = 0","/**\n * Entrypoint for gradually replacing global.js\n *\n * At some point everything in this folder should be able to be removed (new base theme).\n *\n * @author Adam Charron <adam.c@vanillaforums.com>\n * @copyright 2009-2018 Vanilla Forums Inc.\n * @license GPLv2\n */\n\nimport { onContent, onReady } from \"@core/application\";\nimport { initializeAtComplete } from \"./atwho\";\n\n// Initialize legacy @mentions for all BodyBox elements.\nif ($.fn.atwho) {\n    onReady(() => initializeAtComplete(\".BodyBox,.js-bodybox\"));\n    onContent(() => initializeAtComplete(\".BodyBox,.js-bodybox\"));\n\n    // Also assign this function to the global `gdn` object.\n    // The advanced editor calls this function directly when in wysiwyg format, as it needs to\n    // handle an iframe, and the editor instance needs to be referenced. The advanced editor does not yet use\n    // this build process so it can only communicate through here with a global.\n    window.gdn.atCompleteInit = initializeAtComplete;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/legacy/index.ts","/**\n * At-who setup for legacy @mentions.\n *\n * @author Adam Charron <adam.c@vanillaforums.com>\n * @copyright 2009-2018 Vanilla Forums Inc.\n * @license GPLv2\n */\n\nimport { formatUrl, getMeta } from \"@core/application\";\nimport { log } from \"@core/utility\";\n\n// Store cache results in an outer scoped variable., so all instances share the same data\n// and can build the cache together.\nconst atCache = {};\nconst atEmpty = {};\n\n// The current raw match. This is needed to properly match quoted strings.\nlet rawMatch: string | undefined;\n\n// Set minimum characters to type for @mentions to fire\nconst minCharacters = getMeta('mentionMinChars', 2);\n\n// Max suggestions to show in dropdown.\nconst maxSuggestions = getMeta('mentionSuggestionCount', 5);\n\n// Server response limit. This should match the limit set in\n// *UserController->TagSearch* and UserModel->TagSearch\nconst serverLimit = 30;\n\n// Emoji, set in definition list in foot, by Emoji class. Make sure\n// that class is getting instantiated, otherwise emoji will be empty.\n\ninterface IEmojiData {\n    assetPath?: string;\n    emoji?: {\n        [key: string]: string;\n    };\n    format?: string;\n}\n\nconst emojiData: IEmojiData = getMeta('emoji', {});\nconst emojis = emojiData.emoji || {};\nconst emojiFormat = emojiData.format || '';\nconst emojiAssetPath = emojiData.assetPath || '';\n\nconst emojiList = Object.entries(emojis).map(([index, emojiImageUrl]) => {\n    const parts = emojiImageUrl.split('.');\n\n    return {'name': index, 'filename': emojiImageUrl, 'basename': parts[0], 'ext': '.' + parts[1]};\n});\n\nconst emojiContentTemplate = emojiFormat\n    .replace(/{(.+?)}/g, '$${$1}')\n    .replace('%1$s', '${src}')\n    .replace('%2$s', '${name}')\n    .replace('${src}', emojiAssetPath + '/${filename}')\n    .replace('${dir}', emojiAssetPath);\nconst emojiTemplate = '<li data-value=\":${name}:\" class=\"at-suggest-emoji\"><span class=\"emoji-wrap\">' + emojiContentTemplate + '</span> <span class=\"emoji-name\">${name}</span></li>';\n\n/**\n * Custom matching to allow quotation marks in the matching string as well as spaces.\n * Spaces make things more complicated.\n *\n * @param flag - The character sequence used to trigger this match (e.g. :).\n * @param subtext - The string to be tested.\n * @param shouldStartWithSpace - Should the pattern include a test for a whitespace prefix?\n * @returns Matching string if successful.  Null on failure to match.\n */\nexport function matchAtMention(flag: string, subtext: string, shouldStartWithSpace: boolean): string|null {\n    // Split the string at the lines to allow for a simpler regex.\n    const lines = subtext.split(\"\\n\");\n    const lastLine = lines[lines.length - 1];\n\n    // If you change this you MUST change the regex in src/scripts/__tests__/legacy.test.js !!!\n    /**\n     * Put together the non-excluded characters.\n     *\n     * @param {boolean} excludeWhiteSpace - Whether or not to exclude whitespace characters.\n     *\n     * @returns {string} A Regex string.\n     */\n    function nonExcludedCharacters(excludeWhiteSpace) {\n        let excluded = '[^' +\n            '\"' + // Quote character\n            '\\\\u0000-\\\\u001f\\\\u007f-\\\\u009f' + // Control characters\n            '\\\\u2028';// Line terminator\n\n        if (excludeWhiteSpace) {\n            excluded += '\\\\s';\n        }\n\n        excluded += \"]\";\n        return excluded;\n    }\n\n    let regexStr =\n        '@' + // @ Symbol triggers the match\n        '(' +\n        // One or more non-greedy characters that aren't excluded. White is allowed, but a starting quote is required.\n        '\"(' + nonExcludedCharacters(false) + '+?)\"?' +\n\n        '|' + // Or\n        // One or more non-greedy characters that aren't exluded. Whitespace is excluded.\n        '(' + nonExcludedCharacters(true) + '+?)\"?' +\n\n        ')' +\n        '(?:\\\\n|$)'; // Newline terminates.\n\n    // Determined by at.who library\n    if (shouldStartWithSpace) {\n        regexStr = '(?:^|\\\\s)' + regexStr;\n    }\n    const regex = new RegExp(regexStr, 'gi');\n    const match = regex.exec(lastLine);\n    if (match) {\n        rawMatch = match[0];\n\n        // Return either of the matching groups (quoted or unquoted).\n        return match[2] ||  match[1];\n    } else {\n\n        // No match\n        return null;\n    }\n}\n\n/**\n * Custom matching for our emoji images. Eg. :) :/ >:(\n *\n * @param flag - The character sequence used to trigger this match (e.g. :).\n * @param subtext - The string to be tested.\n * @param shouldStartWithSpace - Should the pattern include a test for a whitespace prefix?\n * @returns Matching string if successful.  Null on failure to match.\n */\nexport function matchFakeEmoji(flag, subtext, shouldStartWithSpace) {\n    flag = flag.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n    if (shouldStartWithSpace) {\n        flag = '(?:^|\\\\s)' + flag;\n    }\n\n    // Some browsers append a linefeed to the end of subtext.  We need to allow for it.\n    const regexp = new RegExp(flag + '([A-Za-z0-9_\\+\\-]*|[^\\\\x00-\\\\xff]*)(?:\\\\n)?$', 'gi');\n    const match = regexp.exec(subtext);\n\n    if (match) {\n        return match[2] || match[1];\n    } else {\n        return null;\n    }\n}\n\nexport function initializeAtComplete(editorElement, iframe?: HTMLIFrameElement) {\n\n    // Handle iframe situation\n    const iframeWindow = iframe ? iframe.contentWindow : '';\n\n    function remoteDataHandler(query, callback) {\n        // Do this because of undefined when adding spaces to\n        // matcher callback, as it will be monitoring changes.\n        query = query || '';\n\n        // Only all query strings greater than min_characters\n        if (query.length >= minCharacters) {\n\n            // If the cache array contains less than LIMIT 30\n            // (according to server logic), then there's no\n            // point sending another request to server, as there\n            // won't be any more results, as this is the maximum.\n            let shouldContinueFiltering = true;\n\n            // Remove last character so that the string can be\n            // found in the cache, if exists, then check if its\n            // matching array has less than the server limit of\n            // matches, which means there are no more, so save the\n            // additional server request from being sent.\n            let filterString = '';\n\n            // Loop through string and find first closest match in\n            // the cache, and if a match, check if more filtering\n            // is required.\n            for (let i = 0, l = query.length; i < l; i++) {\n                filterString = query.slice(0, -i);\n\n                if (atCache[filterString]\n                    && atCache[filterString].length < serverLimit) {\n\n                    // Add this other query to empty array, so that it\n                    // will not fire off another request.\n                    atEmpty[query] = query;\n\n                    // Do not filter more, meaning, do not send\n                    // another server request, as all the necessary\n                    // data is already in memory.\n                    shouldContinueFiltering = false;\n                    break;\n                }\n            }\n\n            // Check if query would be empty, based on previously\n            // cached empty results. Compare against the start of\n            // the latest query string.\n            let isQueryEmpty = false;\n\n            // Loop through cache of empty query strings.\n            for (const key in atEmpty) {\n                if (atEmpty.hasOwnProperty(key)) {\n                    // See if cached empty results match the start\n                    // of the latest query. If so, then no point\n                    // sending new request, as it will return empty.\n                    if (query.match(new RegExp('^' + key + '+')) !== null) {\n                        isQueryEmpty = true;\n                        break;\n                    }\n                }\n            }\n\n            function filterSuccessHandler(data) {\n                if (Array.isArray(data)) {\n                    data.forEach((result) => {\n                        if (typeof result === \"object\" && typeof result.name === \"string\") {\n                            // Convert special characters to safely insert into template.\n                            result.name = result.name.replace(/&/g, \"&amp;\")\n                                .replace(/</g, \"&lt;\")\n                                .replace(/>/g, \"&gt;\")\n                                .replace(/\"/g, \"&quot;\")\n                                .replace(/'/g, \"&apos;\");\n                        }\n                    });\n                }\n\n                callback(data);\n\n                // If data is empty, cache the results to prevent\n                // other requests against similarly-started\n                // query strings.\n                if (data.length) {\n                    atCache[query] = data;\n                } else {\n                    atEmpty[query] = query;\n                }\n            }\n\n            // Produce the suggestions based on data either\n            // cached or retrieved.\n            if (shouldContinueFiltering && !isQueryEmpty && !atCache[query]) {\n                $.getJSON(formatUrl('/user/tagsearch'), {\n                    \"q\": query,\n                    \"limit\": serverLimit\n                }, filterSuccessHandler);\n            } else {\n                // If no point filtering more as the parent filter\n                // has not been maxed out with responses, use the\n                // closest parent filter instead of the latest\n                // query string.\n                if (!shouldContinueFiltering) {\n                    callback(atCache[filterString]);\n                } else {\n                    callback(atCache[query]);\n                }\n            }\n        }\n    }\n\n    /**\n     * Pre-insert handler for atwho.\n     *\n     * Note, in contenteditable mode (iframe for us), the value is surrounded by span tags.\n     */\n    function beforeInsertHandler(value: string, $li: JQuery<any>): string {\n        // It's better to use the value provided, as it may have\n        // html tags around it, depending on mode. Using the\n        // regular expression avoids the need to check what mode\n        // the suggestion is made in, and then constructing\n        // it based on that. Optional assignment for undefined\n        // matcher callback results.\n        let username = $li.data('value') || '';\n        // Pop off the flag--usually @ or :\n        username = username.slice(1, username.length);\n\n        // Check if there are any whitespaces, and if so, add\n        // quotation marks around the whole name.\n        const requiresQuotation = /[^\\w-]/.test(username);\n\n        // Check if there are already quotation marks around\n        // the string--double or single.\n        const hasQuotation = /([\"'])(.+)([\"'])/g.test(username);\n\n        let insert = username;\n        if (requiresQuotation && !hasQuotation) {\n            // Do not even need to have value wrapped in\n            // any tags at all. It will be done automatically.\n            // insert = value.replace(/(.*\\>?)@([\\w\\d\\s\\-\\+\\_]+)(\\<?.*)/, '$1@\"$2\"$3');\n            insert = '\"' + username + '\"';\n        }\n\n        // This is needed for checking quotation mark directly\n        // after at character, and preventing another at character\n        // from being inserted into the page.\n        const raw_at_match = rawMatch || '';\n\n        const atQuote = /.?@([\"'])/.test(raw_at_match);\n\n        // If atQuote is false, then insert the at character,\n        // otherwise it means the user typed a quotation mark\n        // directly after the at character, which, would get\n        // inserted again if not checked. atQuote would\n        // be false most of the time; the exception is when\n        // it's true.\n        if (!atQuote) {\n            insert = this.at + insert;\n        }\n\n        // The last character prevents the matcher from trigger on nearly everything.\n        return insert;\n    }\n\n    /**\n     * Custom highlighting to accept spaces in names.\n     * This is almost a copy of the default in the library, with tweaks in the regex.\n     */\n    function highlightHandler(li: string, query: string): string {\n        if (!query) {\n            return li;\n        }\n        const regexp = new RegExp(\">\\\\s*(\\\\w*)(\" + query.replace(\"+\", \"\\\\+\") + \")(\\\\w*)\\\\s*(\\\\s+.+)?<\", 'ig');\n        // Capture group 4 for possible spaces\n        return li.replace(regexp, (str, $1, $2, $3, $4) => {\n            // Weird Chrome behaviour, so check for undefined, then\n            // set to empty string if so.\n            if (typeof $3 === 'undefined') {\n                $3 = '';\n            }\n            if (typeof $4 === 'undefined') {\n                $4 = '';\n            }\n\n            return '> ' + $1 + '<strong>' + $2 + '</strong>' + $3 + $4 + ' <';\n        });\n    }\n\n    $(editorElement)\n        .atwho({\n            at: '@',\n            tpl: '<li data-value=\"@${name}\" data-id=\"${id}\">${name}</li>',\n            limit: maxSuggestions,\n            callbacks: {\n                remote_filter: remoteDataHandler,\n                before_insert: beforeInsertHandler,\n                highlighter: highlightHandler,\n                matcher: matchAtMention,\n            },\n            cWindow: iframeWindow\n        })\n        .atwho({\n            at: ':',\n            tpl: emojiTemplate,\n            insert_tpl: \"${atwho-data-value}\",\n            callbacks: {\n                matcher: matchFakeEmoji,\n                tplEval: (tpl, map) => log(map),\n            },\n            limit: maxSuggestions,\n            data: emojiList,\n            cWindow: iframeWindow\n        });\n\n    /**\n     * This hook is triggered when atWho places a selection list in the window.\n     * The context is passed implicitly when triggered by at.js.\n     *\n     * @param event - A custom event triggered by the advanced editor iframe/wysiwyg.\n     * @param offset - The pixel offsets inside of the iframe.\n     * @param context - Context from the contenteditable inside of the iframe.\n     */\n    function iframeAtWhoRepositionHandler(event: any, offset: any, context: any){\n\n        // Actual suggestion box that will appear.\n        const suggestionElement = context.view.$el;\n\n        // The area where text will be typed (contenteditable body).\n        const $inputor = context.$inputor;\n\n        // Display it below the text.\n        const lineHeight = parseInt($inputor.css('line-height'), 10);\n\n        // offset contains the top left values of the offset to the iframe\n        // we need to convert that to main window coordinates\n        const iframeOffset = $(iframe).offset();\n        let leftCoordinate = (iframeOffset ? iframeOffset.left : 0) + offset.left;\n        let topCoordinate =  iframeOffset ? iframeOffset.top : 0;\n        let selectHeight = 0;\n\n        // In wysiwyg mode, the suggestbox follows the typing, which\n        // does not happen in regular mode, so adjust it.\n        // Either @ or : for now.\n        const at = context.at;\n        const { text } = context.query;\n        const fontMirror = $('.BodyBox,.js-bodybox');\n        const font = fontMirror.css('font-size') + ' ' + fontMirror.css('font-family');\n\n        // Get font width\n        const fontWidth = (at + text).width(font) - 2;\n\n        if (at === '@') {\n            leftCoordinate -= fontWidth;\n        }\n\n        if (at === ':') {\n            leftCoordinate -= 2;\n        }\n\n        // atWho adds 3 select areas, presumably for differnet positing on screen (above below etc)\n        // This finds the active one and gets the container height\n        $(suggestionElement).each((index, element) => {\n            const outerHeight = $(element).outerHeight();\n            const height = $(element).height();\n\n            if (outerHeight && height && outerHeight > 0) {\n                selectHeight += height + lineHeight;\n            }\n        });\n\n        // Now should we show the selection box above or below?\n        const windowHeight = $(window).height() || 0;\n        const scrollPosition = $(window).scrollTop() || 0;\n        const selectionPosition = topCoordinate + offset.top - ($(window).scrollTop() || 0);\n        const iAvailableSpace = windowHeight - (selectionPosition - scrollPosition);\n\n        if (iAvailableSpace >= selectHeight) {\n            // Enough space below\n            topCoordinate = topCoordinate + offset.top + selectHeight - scrollPosition;\n        }\n        else {\n            // Place it above instead\n            // @todo should check if this is more space than below\n            topCoordinate = topCoordinate + offset.top - scrollPosition;\n        }\n\n        // Move the select box\n        const newOffset = {\n            left: leftCoordinate,\n            top: topCoordinate\n        };\n        $(suggestionElement).offset(newOffset);\n    }\n\n\n    // Only necessary for iframe.\n    // Based on work here: https://github.com/ichord/At.js/issues/124\n    if (iframeWindow) {\n        $(iframeWindow).on(\"reposition.atwho\", iframeAtWhoRepositionHandler);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scripts/legacy/atwho.ts"],"sourceRoot":""}